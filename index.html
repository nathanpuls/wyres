<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>wyr.es</title>
<script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col items-center justify-center">

  <!-- Title -->
  <h1 class="text-6xl font-light ld mb-8">wyr.es</h1>

  <!-- Search -->
  <div class="w-full max-w-xl relative">
    <input id="searchInput" type="text" placeholder=""
      class="w-full rounded-lg border px-4 py-3 text-lg focus:outline-none" autofocus autocomplete="off" />

    <!-- Suggestions dropdown -->
    <ul id="suggestions" class="absolute bg-white w-full mt-1 rounded-lg shadow divide-y hidden z-10"></ul>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Initialize Firebase
    firebase.initializeApp({
      apiKey: "AIzaSyDFP5GAwTNqLyaySh_t_2j8NFiulHTeFy8",
      authDomain: "fwdng-1d5f9.firebaseapp.com",
      databaseURL: "https://fwdng-1d5f9.firebaseio.com",
      projectId: "fwdng-1d5f9",
      storageBucket: "fwdng-1d5f9.firebasestorage.app",
      messagingSenderId: "250477002363",
      appId: "1:250477002363:web:95a89409c8d5991a9aacde"
    });

    const db = firebase.database();
    let allAliases = [];

    async function loadAliases() {
      const snap = await db.ref("wyres").get();
      allAliases = snap.exists() ? Object.values(snap.val()) : [];
    }

    loadAliases();

    const searchInput = document.getElementById("searchInput");
    const suggestions = document.getElementById("suggestions");
    let selectedIndex = -1;

    function renderSuggestions(matches) {
      suggestions.innerHTML = matches.map((a, idx) => `
        <li class="px-4 py-2 hover:bg-blue-100 cursor-pointer ${idx === selectedIndex ? 'bg-blue-200' : ''}" data-index="${idx}">
          ${a.alias}
        </li>
      `).join("");
      suggestions.classList.remove("hidden");

      Array.from(suggestions.children).forEach((li, idx) => {
        li.onclick = () => {
          window.location.href = `https://wyr.es/${matches[idx].alias}`;
        };
      });
    }

    function updateHighlight() {
      Array.from(suggestions.children).forEach((li, idx) => {
        li.classList.toggle("bg-blue-200", idx === selectedIndex);
      });
    }

    searchInput.addEventListener("input", () => {
      const q = searchInput.value.toLowerCase().trim();
      if (!q) {
        suggestions.classList.add("hidden");
        suggestions.innerHTML = "";
        selectedIndex = -1;
        return;
      }

      const matches = allAliases
        .filter(a => a.alias.toLowerCase().includes(q))
        .sort((a, b) => {
          const aliasA = a.alias.toLowerCase();
          const aliasB = b.alias.toLowerCase();

          // Exact match first
          if (aliasA === q) return -1;
          if (aliasB === q) return 1;

          // Prefix match second
          if (aliasA.startsWith(q) && !aliasB.startsWith(q)) return -1;
          if (!aliasA.startsWith(q) && aliasB.startsWith(q)) return 1;

          // Alphabetical otherwise
          return aliasA.localeCompare(aliasB);
        })
        .slice(0, 10);

      selectedIndex = -1;
      if (matches.length > 0) renderSuggestions(matches);
      else {
        suggestions.classList.add("hidden");
        suggestions.innerHTML = "";
      }
    });

    searchInput.addEventListener("keydown", (e) => {
      const items = suggestions.children;
      if (e.key === "ArrowDown") {
        e.preventDefault();
        if (!items.length) return;
        selectedIndex = (selectedIndex + 1) % items.length;
        updateHighlight();
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        if (!items.length) return;
        selectedIndex = (selectedIndex - 1 + items.length) % items.length;
        updateHighlight();
      } else if (e.key === "Enter") {
        e.preventDefault();
        if (selectedIndex >= 0) {
          // Go to highlighted suggestion
          window.location.href = `https://wyr.es/${items[selectedIndex].textContent.trim()}`;
        } else {
          // No suggestion highlighted â†’ use typed value
          const typed = searchInput.value.trim();
          if (typed) window.location.href = `https://wyr.es/${typed}`;
        }
      }
    });

    // Close suggestions on click outside
    document.addEventListener("click", e => {
      if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
        suggestions.classList.add("hidden");
      }
    });
  </script>
</body>
</html>
