<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>wyr.es</title>
<style>
  /* Reset some basic styles */
  * {
    box-sizing: border-box;
  }

  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: system-ui, sans-serif;
    background-color: #f1f5f9;
    color: #1e293b;
  }

  body {
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* align to top */
    align-items: center;
    padding: 2vh 2vw;
    overflow-x: hidden; /* prevent horizontal overflow */
  }

  h1 {
    font-weight: 300;
    font-size: clamp(4vh, 10vw, 10vh); /* responsive, never too big */
    margin: 2vh 0;
    text-align: center;
    word-break: break-word;
  }

  .search-container {
    width: 100%;
    max-width: 600px; /* ensure it never exceeds screen width */
    position: relative;
    margin-bottom: 2vh;
  }

  #searchInput {
    width: 100%;
    max-width: 100%; /* never overflow screen */
    padding: 2.5vh 2vw;
    font-size: 4vh;
    border-radius: 16px;
    border: 1px solid #cbd5e1;
  }

  #searchInput:focus {
    outline: none;
  }

  #suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    margin-top: 0.5rem;
    padding: 0;
    list-style: none;
    max-height: 50vh; /* allow scrolling if too many items */
    overflow-y: auto;
    display: none;
    z-index: 10;
    font-size: 4vh; /* match search input font size */
  }

  #suggestions li {
    padding: 2vh 2vw; /* match input height for easy tapping */
    cursor: pointer;
  }

  #suggestions li:hover,
  #suggestions li.active {
    background-color: #dbeafe;
  }

  /* Larger screens */
  @media (min-width: 600px) {
    h1 {
      font-size: clamp(5vh, 8vw, 12vh);
    }

    #searchInput {
      font-size: 5vh;
      padding: 3vh 2vw;
    }

    #suggestions {
      font-size: 5vh;
    }

    #suggestions li {
      padding: 1.5vh 1vw;
    }
  }
</style>
</head>
<body>

  <h1>wyr.es</h1>

  <div class="search-container">
    <input id="searchInput" type="text" placeholder="" autofocus autocomplete="off" />
    <ul id="suggestions"></ul>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyDFP5GAwTNqLyaySh_t_2j8NFiulHTeFy8",
      authDomain: "fwdng-1d5f9.firebaseapp.com",
      databaseURL: "https://fwdng-1d5f9.firebaseio.com",
      projectId: "fwdng-1d5f9",
      storageBucket: "fwdng-1d5f9.firebasestorage.app",
      messagingSenderId: "250477002363",
      appId: "1:250477002363:web:95a89409c8d5991a9aacde"
    });

    const db = firebase.database();
    let allAliases = [];

    async function loadAliases() {
      const snap = await db.ref("wyres").get();
      allAliases = snap.exists() ? Object.values(snap.val()) : [];
    }

    loadAliases();

    const searchInput = document.getElementById("searchInput");
    const suggestions = document.getElementById("suggestions");
    let selectedIndex = -1;

    function renderSuggestions(matches) {
      suggestions.innerHTML = matches.map((a, idx) => `
        <li class="${idx === selectedIndex ? 'active' : ''}" data-index="${idx}">
          ${a.alias}
        </li>
      `).join("");
      suggestions.style.display = matches.length ? "block" : "none";

      Array.from(suggestions.children).forEach((li, idx) => {
        li.onclick = () => {
          window.location.href = `https://wyr.es/${matches[idx].alias}`;
        };
      });
    }

    function updateHighlight() {
      Array.from(suggestions.children).forEach((li, idx) => {
        li.classList.toggle("active", idx === selectedIndex);
      });
    }

    searchInput.addEventListener("input", () => {
      const q = searchInput.value.toLowerCase().trim();
      if (!q) {
        suggestions.style.display = "none";
        suggestions.innerHTML = "";
        selectedIndex = -1;
        return;
      }

      const matches = allAliases
        .filter(a => a.alias.toLowerCase().includes(q))
        .sort((a, b) => {
          const aliasA = a.alias.toLowerCase();
          const aliasB = b.alias.toLowerCase();
          if (aliasA === q) return -1;
          if (aliasB === q) return 1;
          if (aliasA.startsWith(q) && !aliasB.startsWith(q)) return -1;
          if (!aliasA.startsWith(q) && aliasB.startsWith(q)) return 1;
          return aliasA.localeCompare(aliasB);
        })
        .slice(0, 10);

      selectedIndex = -1;
      renderSuggestions(matches);
    });

    searchInput.addEventListener("keydown", (e) => {
      const items = suggestions.children;
      if (e.key === "ArrowDown") {
        e.preventDefault();
        if (!items.length) return;
        selectedIndex = (selectedIndex + 1) % items.length;
        updateHighlight();
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        if (!items.length) return;
        selectedIndex = (selectedIndex - 1 + items.length) % items.length;
        updateHighlight();
      } else if (e.key === "Enter") {
        e.preventDefault();
        if (selectedIndex >= 0) {
          window.location.href = `https://wyr.es/${items[selectedIndex].textContent.trim()}`;
        } else {
          const typed = searchInput.value.trim();
          if (typed) window.location.href = `https://wyr.es/${typed}`;
        }
      }
    });

    document.addEventListener("click", e => {
      if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
        suggestions.style.display = "none";
      }
    });
  </script>
</body>
</html>
